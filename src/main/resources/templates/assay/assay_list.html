<!DOCTYPE html>
<html lang="en" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layui/layui.js" media="all">
    <link rel="stylesheet" href="/css/custom.form.css">
<!--    <script src="../../static/layui/layui.js"></script>-->
<!--    <link rel="stylesheet" href="..css/layui/layui.css">-->
</head>
<body>
<div class="demoTable">
    搜索id：
    <div class="layui-inline">
        <input class="layui-input" name="keyword" id="demoReload" autocomplete="off">
    </div>
    <button class="layui-btn" data-type="reload">搜索</button>
</div>

<table class="layui-hide" id="LAY_table_user" lay-filter="useruv"></table>
<script type="text/html" id="barDemo">
<!--    class="layui-btn layui-btn-xs"-->
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<table id="demo" lay-filter="test"></table>

<!--<script src="../../static/layui/layui.js" ></script>-->
<script src="/layui/layui.all.js"></script>
<script src="/layui/layui.js"></script>
<script src="/js/core.util.js"></script>

<script>
    layui.use('table', function(){
        var table = layui.table;
        var token = CoreUtil.getData("access_token");
        //第一个实例
        table.render({
            elem: '#LAY_table_user'
            ,height: 312
            , headers: {"authorization": token}
            ,url: '/assay/getStuList' //数据接口
            ,page: true //开启分页

            ,cols: [
                        [ //表头
                            {checkbox: true, fixed: true}
                ,{field: 'Stu_id', title: '编号', width:80, sort: true, fixed: 'true'}
                ,{field: 'Stu_name', title: '姓名', width:80}
                ,{field: 'Stu_card', title: '身份证', width:80, sort: true}
                ,{field: 'Stu_college', title: '学院', width:80}
                ,{field: 'Stu_major', title: '专业', width: 80}
                ,{field: 'Stu_class', title: '班级', width: 80, sort: true}
                ,{field: 'Stu_num', title: '学号', width: 80, sort: true}
                ,{field: 'Stu_sex', title: '性别', width: 80}
                ,{field: 'Stu_birth', title: '出生年月日', width: 135, sort: true}
                ,{field:'right', title: '操作', width:178,toolbar:"#barDemo"}
                    ]
            ]
            ,id: 'testReload'
            ,page: true
            ,height: 600
        });
        var $ = layui.$, active = {
            reload: function(){
                var demoReload = $('#demoReload');

                table.reload('testReload', {
                    where: {
                        keyword: demoReload.val()
                    }
                });
            }
        };



        //监听表格复选框选择
        table.on('checkbox(useruv)', function(obj){
            console.log(obj)
        });
        //监听工具条
        table.on('tool(useruv)', function(obj){
            var data = obj.data;
            if(obj.event === 'detail'){
                layer.msg('ID：'+ data.id + ' 的查看操作');
            } else if(obj.event === 'del'){
                layer.confirm('真的删除行么', function(index){
                    console.log(data);
                    $.ajax({
                        url: "UVServlet",
                        type: "POST",
                        data:{"uvid":data.id,"memthodname":"deleteuv","aid":data.aid},
                        dataType: "json",
                        success: function(data){

                            if(data.state==1){
                                obj.del();
                                layer.close(index);
                                layer.msg("删除成功", {icon: 6});
                            }else{
                                layer.msg("删除失败", {icon: 5});
                            }
                        }

                    });
                });
            } else if(obj.event === 'edit'){

                layer.prompt({
                    formType: 2
                    ,title: '修改 ID 为 ['+ data.id +'] 的访问量'
                    ,value: data.uv
                }, function(value, index){
                    EidtUv(data,value,index,obj);



                });



            }
        });

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

        function  EidtUv(data,value,index,obj) {
            $.ajax({
                url: "UVServlet",
                type: "POST",
                data:{"uvid":data.id,"memthodname":"edituv","aid":data.aid,"uv":value},
                dataType: "json",
                success: function(data){

                    if(data.state==1){

                        layer.close(index);
                        //同步更新表格和缓存对应的值
                        obj.update({
                            uv: value
                        });
                        layer.msg("修改成功", {icon: 6});
                    }else{
                        layer.msg("修改失败", {icon: 5});
                    }
                }

            });
        }



    });

</script>
<!--<div class="panel panel-default operation_role" hidden>-->
<!--    <div class="panel-heading title"></div>-->
<!--    <div class="layui-card-body">-->
<!--        <form class="layui-form " action="" lay-filter="deptInfo" style="width: 700px;margin-top: 10px">-->
<!--            <input name="id" hidden/>-->
<!--            <input name="pid" hidden/>-->

<!--            <div class="layui-form-item">-->
<!--                <label class="layui-form-label">角色名称</label>-->
<!--                <div class="layui-input-block">-->
<!--                    <input type="name" name="name" placeholder="请输入角色名称" autocomplete="off" class="layui-input">-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="layui-form-item">-->
<!--                <div class="layui-form-label ">备注</div>-->
<!--                <div class="layui-input-block">-->
<!--                    <input type="description" name="description" placeholder="请输入备注信息" autocomplete="off"-->
<!--                           class="layui-input">-->
<!--                </div>-->
<!--            </div>-->

<!--            <div class="layui-form-item">-->
<!--                <label class="layui-form-label">状态</label>-->
<!--                <div class="layui-input-block">-->
<!--                    <input type="checkbox" name="status" lay-skin="switch" lay-filter="switch" lay-text="启用|禁用" checked>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="layui-form-item">-->
<!--                <label class="layui-form-label">请选择权限</label>-->
<!--            </div>-->
<!--            <div class="layui-form-item">-->
<!--                <div class="layui-tree">-->
<!--                    <div id="permissionTree"></div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="layui-form-item">-->
<!--                <div class="layui-input-block">-->
<!--                    <button type="submit" class="layui-btn" lay-submit="" lay-filter="submit">保存</button>-->
<!--                    <button class="layui-btn layui-btn-primary" id="btn_cancel">返回</button>-->
<!--                </div>-->
<!--            </div>-->
<!--        </form>-->
<!--    </div>-->
<!--</div>-->
<!--<div class="role_table_div">-->
<!--    <div id="searchParam" shiro:hasPermission="sys:role:list">-->
<!--        <div class="layui-form-item">-->
<!--            <div class="layui-input-inline">-->
<!--                <input type="text" id="roleName" class="layui-input" autocomplete="off" placeholder="请输入角色名称">-->
<!--            </div>-->
<!--            <div class="layui-input-inline">-->
<!--                <input type="text" readonly class="layui-input" id="createTime" placeholder="创建时间">-->
<!--            </div>-->
<!--            <div class="layui-input-inline layui-form">-->
<!--                <select id="status">-->
<!--                    <option value="">请选择角色状态</option>-->
<!--                    <option value="1">正常</option>-->
<!--                    <option value="0">弃用</option>-->
<!--                </select>-->
<!--            </div>-->
<!--            <div class="layui-input-inline ">-->
<!--                <button class="layui-btn" onclick="search()" id="search">查询</button>-->
<!--            </div>-->
<!--        </div>-->

<!--    </div>-->
<!--    <table class="layui-hide" id="role_table" lay-filter="role_table"></table>-->
<!--</div>-->
</body>
<!--<script type="text/html" id="toolbar">-->
<!--    <div class="layui-btn-container">-->
<!--        <button class="layui-btn layui-btn-sm" lay-event="addNewRole" shiro:hasPermission="sys:role:add">添加</button>-->
<!--    </div>-->
<!--</script>-->
<!--<script type="text/html" id="tool">-->
<!--    <a class="layui-btn layui-btn-xs" lay-event="edit" shiro:hasPermission="sys:role:update">编辑</a>-->
<!--    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" shiro:hasPermission="sys:role:deleted">删除</a>-->
<!--</script>-->
<!--<script src="/layui/layui.all.js"></script>-->
<!--<script src="/js/core.util.js"></script>-->
<!--<script>-->
<!--    //获取token-->
<!--    var token = CoreUtil.getData("access_token");-->
<!--    //地址栏转义token中的#号-->
<!--    var tokenQuery = token.replace("#", "%23");-->
<!--    var tableIns1;-->
<!--    var table = layui.table;-->
<!--    var form = layui.form;-->
<!--    var layer = layui.layer;-->
<!--    var $ = jQuery = layui.jquery;-->
<!--    var laydate = layui.laydate;-->
<!--    var tree = layui.tree;-->
<!--    var startTime = null;-->
<!--    var endTime = null;-->
<!--    layui.use(['table', 'laypage', 'layer', 'laydate', 'tree'], function () {-->

<!--        tableIns1 = table.render({-->
<!--            elem: '#role_table'-->
<!--            , contentType: 'application/json'-->
<!--            , headers: {"authorization": token}-->
<!--            , page: true //开启分页-->
<!--            , url: '/sys/roles' //数据接口-->
<!--            , method: 'POST'-->
<!--            , parseData: function (res) { //将原始数据解析成 table 组件所规定的数据-->
<!--                return {-->
<!--                    "code": res.code, //解析接口状态-->
<!--                    "msg": res.msg, //解析提示文本-->
<!--                    "count": CoreUtil.isEmpty(res.data) ? 0 : res.data.total, //解析数据长度-->
<!--                    "data": CoreUtil.isEmpty(res.data) ? null : res.data.records //解析数据列表-->
<!--                }-->
<!--            }-->
<!--            , cols: [-->
<!--                [-->
<!--                    {type: 'checkbox', fixed: 'left'},-->
<!--                    {field: 'name', title: '角色名称', width: 200},-->
<!--                    {field: 'createTime', title: '创建时间', minWidth: 120},-->
<!--                    {field: 'updateTime', title: '更新时间', minWidth: 120},-->
<!--                    {-->
<!--                        field: 'status', title: '状态', width: 100, templet: function (item) {-->
<!--                            if (item.status === 1) {-->
<!--                                return '  <input type="checkbox" lay-skin="switch" lay-text="正常|弃用" checked disabled>';-->
<!--                            }-->
<!--                            if (item.status === 0) {-->
<!--                                return '  <input type="checkbox" lay-skin="switch" lay-text="正常|弃用" disabled>';-->
<!--                            }-->
<!--                        }-->
<!--                    },-->
<!--                    {field: 'description', title: '描述', width: 300},-->
<!--                    {title: '操作', width: 250, toolbar: '#tool'}-->
<!--                ]-->
<!--            ]-->
<!--            , toolbar: '#toolbar'-->
<!--        });-->


<!--       -->
<!--        laydate.render({-->
<!--            elem: '#createTime'-->
<!--            , type: 'datetime'-->
<!--            , range: '~'-->
<!--            , done: function (value, date, endDate) {-->
<!--                if (value != null && value != undefined && value != "") {-->
<!--                    startTime = value.split("~")[0];-->
<!--                    endTime = value.split("~")[1];-->
<!--                } else {-->
<!--                    startTime = null;-->
<!--                    endTime = null;-->
<!--                }-->

<!--            }-->
<!--        });-->
<!--        table.on('toolbar(role_table)', function (obj) {-->
<!--            var data = obj.data;-->
<!--            switch (obj.event) {-->
<!--                case 'addNewRole':-->
<!--                    //隐藏表格-->
<!--                    $(".role_table_div").hide();-->
<!--                    //显示编辑窗口-->
<!--                    $(".operation_role").show();-->
<!--                    $(".title").html("新增角色");-->
<!--                    $(".operation_role input[name=id]").val("");-->
<!--                    $(".operation_role input[name=pid]").val("");-->
<!--                    $(".operation_role input[name=name]").val("");-->
<!--                    $(".operation_role input[name=description]").val("");-->
<!--                    $(".operation_role input[name=status]").attr('checked', 'checked');-->
<!--                    $(".operation_role input[name=status]").attr('type', 'hidden').val(1);-->
<!--                    var x = document.getElementsByClassName("layui-unselect layui-form-switch");-->
<!--                    x[0].setAttribute("class", "layui-unselect layui-form-switch layui-form-onswitch");-->
<!--                    var d = document.getElementsByTagName('em')[0];-->
<!--                    d.firstChild.nodeValue = '启用';-->
<!--                    form.render(); //更新全部-->
<!--                    initTree();-->
<!--                    break;-->
<!--            }-->
<!--        });-->
<!--        table.on('tool(role_table)', function (obj) {-->
<!--            var data = obj.data;-->
<!--            switch (obj.event) {-->
<!--                case 'del':-->
<!--                    tipDialog(data.id);-->
<!--                    break;-->
<!--                case 'edit':-->
<!--                    $(".role_table_div").hide();-->
<!--                    //显示编辑窗口-->
<!--                    $(".operation_role").show();-->
<!--                    $(".title").html("编辑角色");-->
<!--                    getRoleDetail(data.id);-->
<!--                    break;-->
<!--            }-->
<!--        });-->
<!--        var getRoleDetail = function (id) {-->
<!--            CoreUtil.sendGet("/sys/role/" + id, null, function (res) {-->
<!--                $(".operation_role input[name=id]").val(res.data.id);-->
<!--                $(".operation_role input[name=pid]").val(res.data.pid);-->
<!--                $(".operation_role input[name=name]").val(res.data.name);-->
<!--                $(".operation_role input[name=description]").val(res.data.description);-->
<!--                if (res.data.status == 1) {-->
<!--                    $(".operation_role input[name=status]").attr('checked', 'checked');-->
<!--                    $(".operation_role input[name=status]").attr('type', 'hidden').val(1);-->
<!--                    var x = document.getElementsByClassName("layui-unselect layui-form-switch");-->
<!--                    x[0].setAttribute("class", "layui-unselect layui-form-switch layui-form-onswitch");-->
<!--                    var d = document.getElementsByTagName('em')[0];-->
<!--                    d.firstChild.nodeValue = '启用';-->
<!--                } else {-->
<!--                    $(".operation_role input[name=status]").attr('type', 'hidden').removeAttr("checked").val(0);-->
<!--                    var x = document.getElementsByClassName("layui-unselect layui-form-switch");-->
<!--                    x[0].setAttribute("class", "layui-unselect layui-form-switch");-->
<!--                    var d = document.getElementsByTagName('em')[0];-->
<!--                    d.firstChild.nodeValue = '禁用';-->
<!--                }-->
<!--                loadPermissionTree(res.data.permissionRespNodes);-->
<!--                form.render(); //更新全部-->

<!--            });-->
<!--        }-->
<!--        var initTree = function () {-->
<!--            CoreUtil.sendGet("/sys/permission/tree/all", null, function (res) {-->
<!--                loadPermissionTree(res.data);-->
<!--            });-->
<!--        };-->
<!--        var loadPermissionTree = function (data) {-->
<!--            tree.render({-->
<!--                elem: '#permissionTree'-->
<!--                , data: data-->
<!--                , onlyIconControl: true  //是否仅允许节点左侧图标控制展开收缩-->
<!--                , showCheckbox: true  //是否显示复选框-->
<!--                , id: 'permissionIds'-->
<!--                , accordion: false-->
<!--                , click: function (obj) {-->
<!--                    selectNode = obj;-->
<!--                    layer.msg(JSON.stringify(selectNode.data.title));-->
<!--                }-->
<!--            });-->


<!--        };-->
<!--        form.on('switch(switch)', function () {-->
<!--            $(".operation_role input[name=status]").attr('type', 'hidden').val(this.checked ? 1 : 0);-->

<!--        });-->
<!--        $("#btn_cancel").click(function () {-->
<!--            $(".role_table_div").show();-->
<!--            $(".operation_role").hide();-->
<!--            return false;-->
<!--        });-->
<!--        //监听提交-->
<!--        form.on('submit(submit)', function (data) {-->
<!--            var permissionIds = [];-->
<!--            var brchArrays = tree.getChecked('permissionIds');-->
<!--            var params = {-->
<!--                id: data.field.id,-->
<!--                name: data.field.name,-->
<!--                description: data.field.description,-->
<!--                status: data.field.status,-->
<!--                permissions: getPermissionIds(brchArrays, permissionIds)-->
<!--            }-->
<!--            if (data.field.id === undefined || data.field.id === null || data.field.id === "") {-->
<!--                CoreUtil.sendPost("/sys/role", params, function (res) {-->
<!--                    $(".role_table_div").show();-->
<!--                    $(".operation_role").hide();-->
<!--                    search();-->
<!--                });-->
<!--            } else {-->
<!--                CoreUtil.sendPut("/sys/role", params, function (res) {-->
<!--                    //显示表格-->
<!--                    $(".role_table_div").show();-->
<!--                    //隐藏编辑窗口-->
<!--                    $(".operation_role").hide();-->
<!--                    search();-->
<!--                });-->
<!--            }-->

<!--            return false;-->
<!--        });-->
<!--        var tipDialog = function (id) {-->
<!--            layer.open({-->
<!--                content: '确定要删除么',-->
<!--                yes: function (index, layero) {-->
<!--                    layer.close(index); //如果设定了yes回调，需进行手工关闭-->
<!--                    CoreUtil.sendDelete("/sys/role/" + id, null, function (res) {-->
<!--                        layer.msg(res.msg);-->
<!--                        search();-->
<!--                    });-->
<!--                }-->
<!--            });-->
<!--        }-->
<!--    });-->

<!--    function getPermissionIds(jsonObj, permissionIds) {-->
<!--        if (jsonObj == undefined || jsonObj == null || !jsonObj instanceof Object) {-->
<!--            return null;-->
<!--        }-->
<!--        for (var i = 0; i < jsonObj.length; i++) {-->
<!--            permissionIds.push(jsonObj[i].id);-->
<!--            getPermissionIds(jsonObj[i].children, permissionIds);-->
<!--        }-->
<!--        return permissionIds;-->
<!--    }-->

<!--    //执行查询-->
<!--    function search() {-->
<!--        //这里以搜索为例-->
<!--        tableIns1.reload({-->
<!--            where: { //设定异步数据接口的额外参数，任意设-->
<!--                name: $("#roleName").val(),-->
<!--                status: $("#status").val(),-->
<!--                startTime: startTime,-->
<!--                endTime: endTime,-->

<!--            }-->
<!--            , page: {-->
<!--                curr: 1 //重新从第 1 页开始-->
<!--            }-->
<!--        });-->
<!--    };-->
<!--</script>-->
</html>